<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>신고 댓글</title>
    <!--css 및 라이브러리 링크 시작-->
    <div th:replace="fragment/link :: link"/>
    <!--css 및 라이브러리 링크 끝-->
</head>
<style>
    .display {
        display: block;
    }
    .none {
        display: none;
    }
</style>
<body>
<!--header 시작-->
<div th:replace="fragment/header :: header"/>
<!--프로필 시작-->
<div th:replace="fragment/profile :: profile"/>
<!--프로필 끝-->
<!--header 끝-->

<div class="wrapper">
    <!-- 사이드바 시작 -->
    <div th:replace="fragment/aside_nav :: aside_nav"/>
    <!--사이드바 끝-->

    <section class="content">
        <header class="main-header clearfix">
        </header> <!--헤더 끝-->

        <div class="row">
            <div class="col-md-12">
                <article class="widget widget--tabbed shadow">
                    <div class="tabs">
                        <div class="number-entries">
                            <input class="spinner" name="value" value="5"/>
                        </div>
                        <input type="radio" name="t" id="tab2" checked>
                        <label for="tab2" class="tabs__tab">신고 들어온 댓글</label>
                        <div class="tabs__content">

                            <!-- 신고들어온 댓글-->
                            <div class="tabs__content--2">
                                <div class="media social_msg" th:each="comments : ${decComs}">
                                    <div class="media-body">
                                        <h4 class="media-heading social_msg__heading">댓글 번호 :<span id="comidx">[[${comments.comIdx}]]</span> / 신고
                                            번호 : [[${comments.decIdx}]]</h4>
                                        <input type="hidden" id="revIdx" th:value="${comments.revIdx}">
                                        <p class="social_msg__msg">댓글 작성자 닉네임 : <span id="prIdx">[[${comments.decNick}]]</span></p>

                                        <p class="social_msg__msg">댓글 내용 : [[${comments.comContent}]]</p>
                                        <hr>
                                        <p class="social_msg__msg">신고 내용 : [[${comments.decContent}]]</p>
                                        <p class="social_msg__meta">신고일 : [[${comments.regDate}]]</p>
                                        <div>
                                            <button onclick="clicked(this)" class="btn btn-skyblue">메세지 보내기</button>
                                            <button onclick="deletething()" class="btn btn-red">삭제</button>
                                        </div>
                                    </div>
                                    <div class="modal hidden">
                                        <div class="modal">
                                            <div class="modal__overlay"></div>
                                            <div class="modal__contents">
                                                <div class="modal__header">
                                                    신고 받은 회원에게 메세지 보내기
                                                </div>
                                                <div class="modal__main">
                                                    <h4>댓글이 작성된 리뷰번호 : [[${comments.revIdx}]]</h4>
                                                    <h4>댓글 번호 :[[${comments.comIdx}]] / 신고
                                                        번호 : [[${comments.decIdx}]]</h4>
                                                    <p>댓글 작성자 : <span id="dernick">[[${comments.decNick}]]</span></p>
                                                    <p>보내는 관리자 : 캐치테이블</p>
                                                    <p><input type="text" id="dercontent" class="input-text message" name="message" placeholder="보낼 메세지를 입력하세요."></p>
                                                    <div>
                                                        <button th:onclick="sendadminmsg([[${comments.comIdx}]],[[${comments.decNick}]])" class="btn btn-skyblue">보내기</button>
                                                        <button onclick="cclicked(this)" class="btn btn-light" type="button">닫기</button>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>


                            </div> <!-- /tabs__content 3 -->

                        </div> <!-- /tabs__content CONTAINER -->

                    </div> <!-- /widget__tabs -->

                </article>
            </div>
        </div> <!--/row-->
        <!--페이징 처리-->
        <div class="page_wrap">
                <div class="page_nation" aria-label="Page navigation example">
                    <a th:href="@{/review/comment/report(page=${decComs.number - 1})}"
                       th:class="'page-prev' + (${decComs.number} <= 0 ? ' page-disabled':'')"></a>
                    <span th:each="pageNumber : ${paginationBarNumbers}">
                        <a th:text="${pageNumber + 1}" th:href="@{/review/comment/report(page=${pageNumber})}"
                           th:class="(${pageNumber} == ${decComs.number} ? 'active' : '')">1</a></span>
                    <a th:href="@{/review/comment/report(page=${decComs.number + 1})}" th:class="'page-next' +
                    (${decComs.number} >= ${decComs.totalPages - 1} ? '':' page-disabled')"></a>
                </div>
            </div>
        <!--페이징 끝-->
    </section>
    <!--    footer 시작-->
    <div th:replace="fragment/footer :: footer"/>
    <!--    footer 끝-->
    <div th:replace="fragment/review_modal :: review_modal"></div>
</div> <!-- /wrapper -->

<!--js 연결 시작-->
<div th:replace="fragment/js :: js"/>
<!--js 연결 끝-->

    <script>
        function clicked(event){
            let dv = event.parentNode.parentNode.parentNode.childNodes[3];
            console.log(dv)
            dv.classList.remove("hidden")
        }
        function cclicked(event){
            let dv = event.parentNode.parentNode.parentNode.parentNode.parentNode;
            console.log(dv)
            dv.classList.add("hidden")
        }


        function sendadminmsg(comIdx, derNick) {
            const adminMsg = document.getElementById("dercontent");


            if(adminMsg.value == '') {
                alert("메세지를 입력하세요!");
                adminMsg.focus();
                return false;
            }
            let data1 = {
                derNick : derNick,
                taaContent : adminMsg.value,}
            $.ajax({
                url: "http://localhost:7070/api/talkAdmin/msg",
                type: "GET",
                dataType: "json",
                processData: true,
                contentType: "application/json; charset=UTF-8",
                data: data1,
                success: function(result) {
                    if (result) {
                        console.log(result)
                        alert('업데이트 성공!');
                        location.href='/review/comment/report';
                        // itemList1.itemList1 = result.data;
                        // if(!document.querySelector('#check1').innerText){
                        //     itemList1.boolean1 = true;}
                    } else {
                        alert("전송된 값 없음");
                    }
                },
                error: function() {
                    alert("에러 발생");
                }
            });}

        function deletething(){
            let idx = document.querySelector("#comidx").innerText;
            let revIdx = document.querySelector("#revIdx").value
            let data1 = {idx : idx, revIdx : revIdx}
            $.ajax({
                url: "http://localhost:7070/api/comment/delete",
                type: "GET",
                dataType: "json",
                processData: true,
                contentType: "application/json; charset=UTF-8",
                data: data1,
                success: function(result) {
                    if (result) {
                        console.log(result)
                        alert('삭제!');
                        location.href='/review/comment/report';
                        // itemList1.itemList1 = result.data;
                        // if(!document.querySelector('#check1').innerText){
                        //     itemList1.boolean1 = true;}
                    } else {
                        alert("전송된 값 없음");
                    }
                },
                error: function() {
                    alert("에러 발생");
                }
            })
        }
    </script>
    </body>
</html>